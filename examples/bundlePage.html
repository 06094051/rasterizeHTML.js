<!DOCTYPE html>
<html>
<head>
    <title>Helper page for bundlePage.js</title>
    <script type="text/javascript" src="../build/dependencies/cssom.js"></script> <!-- Only needed for Chrome -->
    <script type="text/javascript" src="../build/dependencies/xmlserializer.js"></script>
    <script type="text/javascript" src="../build/dependencies/url.js"></script>
    <script type="text/javascript" src="../node_modules/ayepromise/ayepromise.js"></script>
    <script type="text/javascript" src="../src/inlineUtil.js"></script>
    <script type="text/javascript" src="../src/inlineCss.js"></script>
    <script type="text/javascript" src="../src/inline.js"></script>
    <script type="text/javascript" src="../src/util.js"></script>
    <script>
        var sendMessage = function (cmd, content) {
            console.log(JSON.stringify({
                cmd: cmd,
                content: content
            }));
        };
        window.bundlePage = function (url) {
            util.loadDocument(url, {}).then(function (doc) {
                inline.inlineReferences(doc, {}).then(function (errors) {
                    var xhtml;

                    errors.forEach(function (error) {
                        sendMessage('log', error.msg);
                    });

                    xhtml = xmlserializer.serializeToString(doc);
                    sendMessage('done', xhtml);
                });
            }, function () {
                sendMessage('log', "error loading file '" + url + "'");
            });

        };
    </script>
</head>
<body>
    <h1>Helper page for bundlePage.js</h1>
    <p>Example usage:</p>
    <pre>phantomjs examples/bundlePage.js test/fixtures/image.html</pre>
    or
    <pre>slimerjs examples/bundlePage.js test/fixtures/image.html</pre>
</body>
</html>
