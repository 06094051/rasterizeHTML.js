/*! rasterizeHTML.js - v0.7.0 - 2014-01-28
* http://www.github.com/cburgmer/rasterizeHTML.js
* Copyright (c) 2014 Christoph Burgmer; Licensed MIT */
window.rasterizeHTMLInline=function(a){"use strict";var b=function(b){return a.util.joinUrl(b,".")},c=function(a){var c=a.map(function(c,d){return d===a.length-1&&(c={baseUrl:b(c.baseUrl)}),JSON.stringify(c)});return c},d=function(b,d){return d.cache!==!1&&"none"!==d.cache&&d.cacheBucket?a.util.memoize(b,c,d.cacheBucket):b},e=function(b,c){var d=b.attributes.src?b.attributes.src.nodeValue:null,e=a.util.getDocumentBaseUrl(b.ownerDocument),f=a.util.clone(c);return!f.baseUrl&&e&&(f.baseUrl=e),a.util.getDataURIForImageURL(d,f).then(function(a){return a},function(a){throw{resourceType:"image",url:a.url,msg:"Unable to load image "+a.url}})},f=function(b){return b.filter(function(b){var c=b.attributes.src?b.attributes.src.nodeValue:null;return null!==c&&!a.util.isDataUri(c)})},g=function(a){return Array.prototype.filter.call(a,function(a){return"image"===a.type})},h=function(a){return Array.prototype.slice.call(a)};a.loadAndInlineImages=function(b,c){var d=h(b.getElementsByTagName("img")),i=g(b.getElementsByTagName("input")),j=f(d.concat(i));return a.util.collectAndReportErrors(j.map(function(a){return e(a,c).then(function(b){a.attributes.src.nodeValue=b})}))};var i=function(b,c,d,e){var f=a.css.rulesForCssText(b);a.css.loadCSSImportsForRules(f,c,d).then(function(c){a.css.loadAndInlineCSSResourcesForRules(f,d,function(d,g){var h=c.errors.concat(g),i=c.hasChanges||d;i&&(b=a.css.cssRulesToText(f)),e(i,b,h)})})},j=function(b,c,e,f){var g=b.textContent,h=d(i,c);h(g,e,c,function(c,d,e){e=a.util.cloneArray(e),c&&(b.childNodes[0].nodeValue=d),f(e)})},k=function(a){var b=a.getElementsByTagName("style");return Array.prototype.filter.call(b,function(a){return!a.attributes.type||"text/css"===a.attributes.type.nodeValue})};a.loadAndInlineStyles=function(b,c,d){var e,f=a.util.parseOptionalParameters(c,d),g=k(b),h=[],i=[];e=a.util.clone(f.options),e.baseUrl=e.baseUrl||a.util.getDocumentBaseUrl(b),a.util.map(g,function(a,b){j(a,e,i,function(a){h=h.concat(a),b()})},function(){f.callback(h)})};var l=function(a,b){var c,d=a.parentNode;b=b.trim(),b&&(c=a.ownerDocument.createElement("style"),c.type="text/css",c.appendChild(a.ownerDocument.createTextNode(b)),d.insertBefore(c,a)),d.removeChild(a)},m=function(b,c,d,e){a.util.ajax(b,c).then(function(e){var f,g=a.css.rulesForCssText(e);f=a.css.adjustPathsOfCssResources(b,g),a.css.loadCSSImportsForRules(g,[],c).then(function(b){a.css.loadAndInlineCSSResourcesForRules(g,c,function(c,h){var i=b.errors.concat(h);(f||b.hasChanges||c)&&(e=a.css.cssRulesToText(g)),d(e,i)})})},e)},n=function(b,c,e,f){var g=b.attributes.href.nodeValue,h=a.util.getDocumentBaseUrl(b.ownerDocument),i=a.util.clone(c);!i.baseUrl&&h&&(i.baseUrl=h);var j=d(m,c);j(g,i,function(b,c){c=a.util.cloneArray(c),e(b,c)},function(){f(a.util.joinUrl(i.baseUrl,g))})},o=function(a){var b=a.getElementsByTagName("link");return Array.prototype.filter.call(b,function(a){return a.attributes.rel&&"stylesheet"===a.attributes.rel.nodeValue&&(!a.attributes.type||"text/css"===a.attributes.type.nodeValue)})};a.loadAndInlineCssLinks=function(b,c,d){var e=a.util.parseOptionalParameters(c,d),f=o(b),g=[];a.util.map(f,function(a,b){n(a,e.options,function(c,d){l(a,c+"\n"),g=g.concat(d),b()},function(a){g.push({resourceType:"stylesheet",url:a,msg:"Unable to load stylesheet "+a}),b()})},function(){e.callback&&e.callback(g)})};var p=function(b,c){var d=b.attributes.src.nodeValue,e=a.util.getDocumentBaseUrl(b.ownerDocument),f=a.util.clone(c);return!f.baseUrl&&e&&(f.baseUrl=e),a.util.ajax(d,f).fail(function(a){throw{resourceType:"script",url:a.url,msg:"Unable to load script "+a.url}})},q=function(a){return a.replace(/<\//g,"<\\/")},r=function(a,b){a.attributes.removeNamedItem("src"),a.textContent=q(b)},s=function(a){var b=a.getElementsByTagName("script");return Array.prototype.filter.call(b,function(a){return!!a.attributes.src})};return a.loadAndInlineScript=function(b,c){var d=s(b);return a.util.collectAndReportErrors(d.map(function(a){return p(a,c).then(function(b){r(a,b)})}))},a.inlineReferences=function(b,c,d){var e=[];a.loadAndInlineImages(b,c).then(function(f){e=e.concat(f),a.loadAndInlineStyles(b,c,function(f){e=e.concat(f),a.loadAndInlineCssLinks(b,c,function(f){e=e.concat(f),c.inlineScripts===!1?d(e):a.loadAndInlineScript(b,c).then(function(a){e=e.concat(a),d(e)})})})})},a}(window.rasterizeHTMLInline||{}),window.rasterizeHTMLInline=function(a,b,c,d){"use strict";a.css={};var e=function(a,b,c){a.style.setProperty(b,c,a.style.getPropertyPriority(b))},f=function(a){var b,c=document.implementation.createHTMLDocument(""),d=document.createElement("style");return d.textContent=a,c.body.appendChild(d),b=d.sheet.cssRules,Array.prototype.slice.call(b)},g=function(){var a=f("a{background:url(i)}");return!a.length||a[0].cssText.indexOf("url()")>=0}();a.css.rulesForCssText=function(a){return g&&c.parse?c.parse(a).cssRules:f(a)};var h=function(a){return a.filter(function(a){return a.type===b.CSSRule.STYLE_RULE&&(a.style.getPropertyValue("background-image")||a.style.getPropertyValue("background"))})},i=function(a){return a.filter(function(a){return a.type===b.CSSRule.FONT_FACE_RULE&&a.style.getPropertyValue("src")})};a.css.cssRulesToText=function(a){return a.reduce(function(a,b){return a+b.cssText},"")};var j=function(a){var b=/^"(.*)"$/,c=/^'(.*)'$/;return b.test(a)?a.replace(b,"$1"):c.test(a)?a.replace(c,"$1"):a},k=function(a){var b=/^[\t\r\f\n ]*(.+?)[\t\r\f\n ]*$/;return a.replace(b,"$1")};a.css.extractCssUrl=function(a){var b,c=/^url\(([^\)]+)\)/;if(!c.test(a))throw new Error("Invalid url");return b=c.exec(a)[1],j(k(b))};var l=function(a){var b,c=/^format\(([^\)]+)\)/;return c.test(a)?(b=c.exec(a)[1],j(b)):null},m=function(b){var c,d=null;try{return c=a.css.extractCssUrl(b[0]),b[1]&&(d=l(b[1])),{url:c,format:d}}catch(e){}},n=function(a,b,c){var d="@font-face { font-family: "+b.style.getPropertyValue("font-family")+"; ";b.style.getPropertyValue("font-style")&&(d+="font-style: "+b.style.getPropertyValue("font-style")+"; "),b.style.getPropertyValue("font-weight")&&(d+="font-weight: "+b.style.getPropertyValue("font-weight")+"; "),d+="src: "+c+"}",o(a,b,d)},o=function(a,b,c){var d=a.indexOf(b),e=b.parentStyleSheet;e.insertRule(c,d+1),e.deleteRule(d),a[d]=e.cssRules[d]};a.css.adjustPathsOfCssResources=function(b,c){var d=!1;return h(c).forEach(function(c){var f=c.style.getPropertyValue("background-image")||c.style.getPropertyValue("background"),g=w(f),h=x(g);h.length>0&&(h.forEach(function(c){var d=g[c].url,e=a.util.joinUrl(b,d);g[c].url=e}),f=y(g),c.style.getPropertyValue("background-image")?e(c,"background-image",f):e(c,"background",f),d=!0)}),i(c).forEach(function(e){var f=B(e.style.getPropertyValue("src")),g=!1;f.forEach(function(c){var d,e=m(c);e&&!a.util.isDataUri(e.url)&&(d=a.util.joinUrl(b,e.url),c[0]='url("'+d+'")',g=!0)}),g&&n(c,e,C(f)),d=d||g}),p(c).forEach(function(e){var f=e.href,g=a.util.joinUrl(b,f);o(c,e,"@import url("+g+");"),d=!0}),d};var p=function(a){return a.filter(function(a){return a.type===b.CSSRule.IMPORT_RULE&&a.href})},q=function(a,b,c){var d=a.indexOf(b);a.splice(d,1),c.forEach(function(b,c){a.splice(d+c,0,b)})},r=function(a){var b=/^"(.*)"$/,c=/^'(.*)'$/;return b.test(a)||c.test(a)},s=function(a){var b=d.defer();return b.resolve(a),b.promise},t=function(b,c,d,e){var f,g=c.href;return r(g)&&(g=j(g)),f=a.util.joinUrl(e.baseUrl,g),d.indexOf(f)>=0?(q(b,c,[]),s([])):(d.push(f),a.util.ajax(g,e).then(function(f){var h=a.css.rulesForCssText(f);return a.css.loadCSSImportsForRules(h,d,e).then(function(d){return a.css.adjustPathsOfCssResources(g,h),q(b,c,h),d.errors})},function(a){throw{resourceType:"stylesheet",url:a.url,msg:"Unable to load stylesheet "+a.url}}))};a.css.loadCSSImportsForRules=function(b,c,d){var e=p(b),f=[],g=!1;return a.util.all(e.map(function(a){return t(b,a,c,d).then(function(a){f=f.concat(a),g=!0},function(a){f.push(a)})})).then(function(){return{hasChanges:g,errors:f}})};var u=function(a){var b,c="\\s*(?:\"[^\"]*\"|'[^']*'|[^\\(]+)\\s*",d="(url\\("+c+"\\)|[^,\\s]+)",e="(?:\\s*"+d+")+",f="^\\s*("+e+")(?:\\s*,\\s*("+e+"))*\\s*$",g=new RegExp(e,"g"),h=[],i=function(a){var b,c=new RegExp(d,"g"),e=[];for(b=c.exec(a);b;)e.push(b[1]),b=c.exec(a);return e};if(a.match(new RegExp(f))){for(b=g.exec(a);b;)h.push(i(b[0])),b=g.exec(a);return h}return[]},v=function(b){var c,d;for(c=0;c<b.length;c++)try{return d=a.css.extractCssUrl(b[c]),{url:d,idx:c}}catch(e){}},w=function(a){var b=u(a);return b.map(function(a){var b=v(a);return b?{preUrl:a.slice(0,b.idx),url:b.url,postUrl:a.slice(b.idx+1)}:{preUrl:a}})},x=function(b){var c=[];return b.forEach(function(b,d){b.url&&!a.util.isDataUri(b.url)&&c.push(d)}),c},y=function(a){var b=a.map(function(a){var b=[].concat(a.preUrl);return a.url&&b.push('url("'+a.url+'")'),a.postUrl&&(b=b.concat(a.postUrl)),b.join(" ")});return b.join(", ")},z=function(b,c){var d=w(b),e=x(d),f=!1;return a.util.collectAndReportErrors(e.map(function(b){var e=d[b].url;return a.util.getDataURIForImageURL(e,c).then(function(a){d[b].url=a,f=!0},function(a){throw{resourceType:"backgroundImage",url:a.url,msg:"Unable to load background-image "+a.url}})})).then(function(a){return{backgroundValue:y(d),hasChanges:f,errors:a}})},A=function(b,c){var d=h(b),f=[],g=!1;return a.util.all(d.map(function(a){var b=a.style.getPropertyValue("background-image")||a.style.getPropertyValue("background");return z(b,c).then(function(b){b.hasChanges&&(a.style.getPropertyValue("background-image")?e(a,"background-image",b.backgroundValue):e(a,"background",b.backgroundValue),g=!0),f=f.concat(b.errors)})})).then(function(){return{hasChanges:g,errors:f}})},B=function(a){var b,c="\\s*(?:\"[^\"]*\"|'[^']*'|[^\\(]+)\\s*",d="(local\\("+c+"\\))|(url\\("+c+"\\))(?:\\s+(format\\("+c+"\\)))?",e="^\\s*("+d+")(?:\\s*,\\s*("+d+"))*\\s*$",f=new RegExp(d,"g"),g=[],h=function(a){var b=[];return a.slice(1).forEach(function(a){a&&b.push(a)}),b};if(a.match(new RegExp(e))){for(b=f.exec(a);b;)g.push(h(b)),b=f.exec(a);return g}return[]},C=function(a){var b=[];return a.forEach(function(a){b.push(a.join(" "))}),b.join(", ")},D=function(b,c,d,e){var f,g=[];f=B(c.style.getPropertyValue("src")),a.util.map(f,function(b,c){var e,f=m(b);return!f||a.util.isDataUri(f.url)?(c(!1),void 0):(e=f.format||"woff",a.util.binaryAjax(f.url,d).then(function(a){var d=btoa(a);b[0]='url("data:font/'+e+";base64,"+d+'")',c(!0)},function(){g.push(a.util.joinUrl(d.baseUrl,f.url)),c(!1)}),void 0)},function(a){var d=a.indexOf(!0)>=0;d&&n(b,c,C(f)),e(d,g)})},E=function(b,c,d){var e,f=i(b),g=[];a.util.map(f,function(a,d){D(b,a,c,function(a,b){b.forEach(function(a){g.push({resourceType:"fontFace",url:a,msg:"Unable to load font-face "+a})}),d(a)})},function(a){e=a.indexOf(!0)>=0,d(e,g)})};return a.css.loadAndInlineCSSResourcesForRules=function(a,b,c){A(a,b).then(function(d){E(a,b,function(a,b){var e=d.hasChanges||a;c(e,d.errors.concat(b))})})},a}(window.rasterizeHTMLInline||{},window,window.CSSOM||{},ayepromise),window.rasterizeHTMLInline=function(a,b,c,d){"use strict";a.util={},a.util.getDocumentBaseUrl=function(a){return"about:blank"!==a.baseURI?a.baseURI:null},a.util.clone=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},a.util.cloneArray=function(a){return Array.prototype.slice.apply(a,[0])},a.util.joinUrl=function(a,b){return d.resolve(a,b)},a.util.isDataUri=function(a){return/^data:/.test(a)},a.util.all=function(a){var b=c.defer(),d=a.length,e=[];return 0===a.length?(b.resolve([]),b.promise):(a.forEach(function(a,c){a.then(function(a){d-=1,e[c]=a,0===d&&b.resolve(e)},function(a){b.reject(a)})}),b.promise)},a.util.collectAndReportErrors=function(b){var c=[];return a.util.all(b.map(function(a){return a.fail(function(a){c.push(a)})})).then(function(){return c})},a.util.map=function(b,c,d){var e,f=0,g=a.util.cloneArray(b),h=[];0===g.length&&d(h);var i=function(a){function b(b){f+=1,h[a]=b,f===g.length&&d(h)}c(g[a],b)};for(e=0;e<g.length;e++)i(e)};var e=null,f=function(a,b){return b===!1||"none"===b||"repeated"===b?((null===e||"repeated"!==b)&&(e=Date.now()),a+"?_="+e):a};a.util.ajax=function(d,e){var g,h=new b.XMLHttpRequest,i=c.defer(),j=a.util.joinUrl(e.baseUrl,d),k=function(){i.reject({msg:"Unable to load url",url:j})};g=f(j,e.cache),h.addEventListener("load",function(){200===h.status||0===h.status?i.resolve(h.response):k()},!1),h.addEventListener("error",k,!1);try{h.open("GET",g,!0),h.overrideMimeType(e.mimeType),h.send(null)}catch(l){k()}return i.promise},a.util.binaryAjax=function(b,c){var d=a.util.clone(c);return d.mimeType="text/plain; charset=x-user-defined",a.util.ajax(b,d).then(function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(255&a.charCodeAt(c));return b})};var g=function(a){var b=function(a,b){return a.substring(0,b.length)===b};return b(a,"<?xml")||b(a,"<svg")?"image/svg+xml":"image/png"};a.util.getDataURIForImageURL=function(b,c){return a.util.binaryAjax(b,c).then(function(a){var b=btoa(a),c=g(a);return"data:"+c+";base64,"+b})};var h=[],i=function(a){return h.indexOf(a)<0&&h.push(a),h.indexOf(a)};a.util.memoize=function(a,b,c){if("object"!=typeof c)throw new Error("cacheBucket is not an object");return function(){var d,e,f=Array.prototype.slice.call(arguments);f.length>2&&"function"==typeof f[f.length-2]?(e=f.pop(),d=f.pop()):d=f.pop();var g,h=b(f),j=i(a);c[j]&&c[j][h]?d.apply(null,c[j][h]):(g=f.concat(function(){c[j]=c[j]||{},c[j][h]=arguments,d.apply(null,arguments)}),e&&(g=g.concat(e)),a.apply(null,g))}};var j=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},k=function(a){return"function"==typeof a};return a.util.parseOptionalParameters=function(){var a={options:{},callback:null};return k(arguments[0])?a.callback=arguments[0]:(a.options=j(arguments[0]),a.callback=arguments[1]||null),a},a}(window.rasterizeHTMLInline||{},window,ayepromise,url),window.rasterizeHTML=function(a,b,c){"use strict";var d={},e=[];d.util={},d.util.getConstantUniqueIdFor=function(a){return e.indexOf(a)<0&&e.push(a),e.indexOf(a)};var f=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},g=function(a){return"object"==typeof a&&null!==a},h=function(a){return g(a)&&Object.prototype.toString.apply(a).match(/\[object (Canvas|HTMLCanvasElement)\]/i)},i=function(a){return"function"==typeof a};d.util.parseOptionalParameters=function(a){var b={canvas:null,options:{},callback:null};return i(a[0])?b.callback=a[0]:null==a[0]||h(a[0])?(b.canvas=a[0]||null,i(a[1])?b.callback=a[1]:(b.options=f(a[1]),b.callback=a[2]||null)):(b.options=f(a[0]),b.callback=a[1]||null),b};var j=function(b,c){return function(){var d=new b,e=d.open;return d.open=function(){var b=Array.prototype.slice.call(arguments),d=b.shift(),f=b.shift(),g=a.util.joinUrl(c,f);return e.apply(this,[d,g].concat(b))},d}};d.util.executeJavascript=function(a,b,d,e){var f=s(c.document,"iframe"),g=a.documentElement.outerHTML,h=[],i=function(){var a=f.contentDocument;c.document.getElementsByTagName("body")[0].removeChild(f),e(a,h)};f.onload=d>0?function(){setTimeout(i,d)}:i,f.contentDocument.open(),f.contentWindow.XMLHttpRequest=j(f.contentWindow.XMLHttpRequest,b),f.contentWindow.onerror=function(a){h.push({resourceType:"scriptExecution",msg:a})},f.contentDocument.write(g),f.contentDocument.close()};var k=function(a,b,c){var d=a.createElement("iframe");return d.style.width=b+"px",d.style.height=c+"px",d.style.visibility="hidden",d.style.position="absolute",d.style.top=-1e4-c+"px",d.style.left=-1e4-b+"px",d.sandbox="allow-same-origin",a.getElementsByTagName("body")[0].appendChild(d),d};d.util.calculateDocumentContentSize=function(a,b,d,e){var f=a.documentElement.outerHTML,g=k(c.document,b,d);g.onload=function(){var a=g.contentDocument,b=Math.max(a.documentElement.scrollWidth,a.body.clientWidth),d=Math.max(a.documentElement.scrollHeight,a.body.scrollHeight,a.body.clientHeight);c.document.getElementsByTagName("body")[0].removeChild(g),e(b,d)},g.contentDocument.open(),g.contentDocument.write(f),g.contentDocument.close()};var l=function(a,b){var d,e,f,g,h=/<html((?:\s+[^>]*)?)>/im.exec(b),i=c.document.implementation.createHTMLDocument("");if(h)for(d="<div"+h[1]+"></div>",i.documentElement.innerHTML=d,f=i.querySelector("div"),e=0;e<f.attributes.length;e++)g=f.attributes[e],a.documentElement.setAttribute(g.name,g.value)};d.util.parseHTML=function(a){var b;return(new DOMParser).parseFromString("<a></a>","text/html")?b=(new DOMParser).parseFromString(a,"text/html"):(b=c.document.implementation.createHTMLDocument(""),b.documentElement.innerHTML=a,l(b,a)),b};var m=null,n=function(a,b){return b===!1||"none"===b||"repeated"===b?((null===m||"repeated"!==b)&&(m=Date.now()),a+"?_="+m):a};d.util.loadDocument=function(b,c,d,e){var f=new window.XMLHttpRequest,g=a.util.joinUrl(c.baseUrl,b),h=n(g,c.cache);f.addEventListener("load",function(){200===f.status||0===f.status?d(f.responseXML):e()},!1),f.addEventListener("error",function(){e()},!1);try{f.open("GET",h,!0),f.responseType="document",f.send(null)}catch(i){e()}};var o=function(){if(c.navigator.userAgent.indexOf("WebKit")>=0&&c.navigator.userAgent.indexOf("Chrome")<0)return!1;if(c.BlobBuilder||c.MozBlobBuilder||c.WebKitBlobBuilder)return!0;if(c.Blob)try{return new c.Blob(["<b></b>"],{type:"text/xml"}),!0}catch(a){return!1}return!1},p=function(a){var b,d="image/svg+xml;charset=utf-8",e=c.BlobBuilder||c.MozBlobBuilder||c.WebKitBlobBuilder;return e?(b=new e,b.append(a),b.getBlob(d)):new c.Blob([a],{type:d})},q=function(a){var b=c.URL||c.webkitURL||window;return o()?b.createObjectURL(p(a)):"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a)},r=function(a){var b=c.URL||c.webkitURL||window;o()&&b.revokeObjectURL(a)},s=function(a,b){var c=a.createElement(b);return c.style.visibility="hidden",c.style.width="0px",c.style.height="0px",c.style.position="absolute",c.style.top="-10000px",c.style.left="-10000px",a.getElementsByTagName("body")[0].appendChild(c),c},t=function(a,b){var c=a.getElementById(b);return c||(c=s(a,"div"),c.id=b),c},u="rasterizeHTML_js_FirefoxWorkaround",v=function(){var a=c.navigator.userAgent.match(/Firefox\/(\d+).0/);return!a||!a[1]||parseInt(a[1],10)<17},w=function(a,b){var e,f=d.util.getConstantUniqueIdFor(a),g=b?b.ownerDocument:c.document;v()&&(e=t(g,u+f),e.innerHTML=a,e.className=u)},x=function(a){window.navigator.userAgent.indexOf("WebKit")>=0&&Array.prototype.forEach.call(a.getElementsByTagName("style"),function(a){a.textContent="span {}\n"+a.textContent})},y=function(a,b){var e=d.util.getConstantUniqueIdFor(a),f=b?b.ownerDocument:c.document,g=f.getElementById(u+e);g&&g.parentNode.removeChild(g)};d.util.addClassNameRecursively=function(a,b){a.className+=" "+b,a.parentNode!==a.ownerDocument&&d.util.addClassNameRecursively(a.parentNode,b)};var z=function(a,b){var c=a.parentStyleSheet,d=Array.prototype.indexOf.call(c.cssRules,a);c.insertRule(b,d+1),c.deleteRule(d)},A=function(a,b){var c=a.cssText.replace(/^[^\{]+/,""),d=b+" "+c;z(a,d)},B=function(a){return Array.prototype.reduce.call(a,function(a,b){return a+b.cssText},"")},C=function(a){a.textContent=B(a.sheet.cssRules)};d.util.rewriteStyleRuleSelector=function(a,b,c){var d=b+"(?=\\W|$)";Array.prototype.forEach.call(a.querySelectorAll("style"),function(a){var b=Array.prototype.filter.call(a.sheet.cssRules,function(a){return a.selectorText&&new RegExp(d).test(a.selectorText)});b.length&&(b.forEach(function(a){var b=a.selectorText.replace(new RegExp(d,"g"),c);A(a,b)}),C(a))})},d.util.fakeHover=function(a,b){var c=a.querySelector(b),e="rasterizehtmlhover";c&&(d.util.addClassNameRecursively(c,e),d.util.rewriteStyleRuleSelector(a,":hover","."+e))},d.util.fakeActive=function(a,b){var c=a.querySelector(b),e="rasterizehtmlactive";c&&(d.util.addClassNameRecursively(c,e),d.util.rewriteStyleRuleSelector(a,":active","."+e))},d.util.persistInputValues=function(a){var b=Array.prototype.slice.call(a.querySelectorAll("input")),c=Array.prototype.slice.call(a.querySelectorAll("textarea")),d=function(a){return"checkbox"===a.type||"radio"===a.type};b.filter(d).forEach(function(a){a.checked?a.setAttribute("checked",""):a.removeAttribute("checked")}),b.filter(function(a){return!d(a)}).forEach(function(a){a.setAttribute("value",a.value)}),c.forEach(function(a){a.textContent=a.value})},d.getSvgForDocument=function(a,c,d){var e;return x(a),e=b.serializeToString(a),'<svg xmlns="http://www.w3.org/2000/svg" width="'+c+'" height="'+d+'"><foreignObject width="100%" height="100%">'+e+"</foreignObject></svg>"},d.renderSvg=function(a,b,d,e){var f,g,h=function(){g.onload=null,g.onerror=null},i=function(){f&&r(f),y(a,b)};w(a,b),f=q(a),g=new c.Image,g.onload=function(){h(),i(),d(g)},g.onerror=function(){i(),e()},g.src=f},d.drawImageOnCanvas=function(a,b){try{b.getContext("2d").drawImage(a,0,0)}catch(c){return!1}return!0},d.drawDocumentImage=function(a,b,c,e,f){var g=E(b,c);c.hover&&d.util.fakeHover(a,c.hover),c.active&&d.util.fakeActive(a,c.active),d.util.calculateDocumentContentSize(a,g.width,g.height,function(c,g){var h=d.getSvgForDocument(a,c,g);d.renderSvg(h,b,function(a){e(a)},f)})};var D=function(a,b,c,e,f){var g=function(a){a.push({resourceType:"document",msg:"Error rendering page"})};d.drawDocumentImage(a,b,c,function(a){var c;b&&(c=d.drawImageOnCanvas(a,b),c||(g(f),a=null)),e&&e(a,f)},function(){g(f),e&&e(null,f)})},E=function(a,b){var c=300,d=200,e=a?a.width:c,f=a?a.height:d,g=void 0!==b.width?b.width:e,h=void 0!==b.height?b.height:f;return{width:g,height:h}},F=function(b,c,e,f){var g,h=e.executeJsTimeout||0;g=a.util.clone(e),g.inlineScripts=e.executeJs===!0,a.inlineReferences(b,g,function(a){e.executeJs?d.util.executeJavascript(b,e.baseUrl,h,function(b,g){d.util.persistInputValues(b),D(b,c,e,f,a.concat(g))}):D(b,c,e,f,a)})};d.drawDocument=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1),c=d.util.parseOptionalParameters(b);F(a,c.canvas,c.options,c.callback)};var G=function(a,b,c,e){var f=d.util.parseHTML(a);d.drawDocument(f,b,c,e)};d.drawHTML=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1),c=d.util.parseOptionalParameters(b);G(a,c.canvas,c.options,c.callback)};var H=function(a,b,c,e){d.util.loadDocument(a,c,function(a){d.drawDocument(a,b,c,e)},function(){e&&e(null,[{resourceType:"page",url:a,msg:"Unable to load page "+a}])})};return d.drawURL=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1),c=d.util.parseOptionalParameters(b);H(a,c.canvas,c.options,c.callback)},d}(window.rasterizeHTMLInline,window.xmlserializer,window);